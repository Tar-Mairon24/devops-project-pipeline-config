#!/usr/bin/env groovy

node {
    stage('parameters') {
        branch = env.BRANCH_NAME
        echo "Branch name: ${branch}"
        echo "Git commit: ${env.GIT_COMMIT}"
        echo "Git commit message: ${env.GIT_COMMIT_MESSAGE}"
        echo "Git author: ${env.GIT_AUTHOR}"
        echo "Git author email: ${env.GIT_AUTHOR_EMAIL}"
        echo "Git author name: ${env.GIT_AUTHOR_NAME}"
        echo "Workspace: ${env.WORKSPACE}"
        sh 'npm --version'
        sh 'node --version'
        sh 'docker --version'
        sh 'docker compose version'

    }
    stage('checkout') {
        checkout scm
        echo "Checking out branch: ${branch}"
        sh 'ls -la'
    }
    stage('Deploy backend develop') {
        if (branch == 'develop') {
            dockerDir = 'docker'
            dir(dockerDir) {
                sh 'ls -la'
                echo "Current directory: ${env.WORKSPACE}/${dockerDir}"
                echo "Building backend in directory: ${dockerDir}"
                sh 'docker compose -f backend.yml down'
                sh 'docker compose -f backend.yml build'
                sh 'docker compose -f backend.yml up -d'
            }
        } else {
                echo "Skipping backend deployment for branch: ${branch}"
            }
    }
    stage('Deploy') {
        echo 'Deploying....'
    }
}
